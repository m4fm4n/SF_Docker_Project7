=======================================================================
Задание:

        Создать ВМ в Я.Облаке (минимальная конфигурация: 2vCPU, 2GB RAM, 20GB HDD).
        Установить и запустить на ВМ Docker.
        Установить и запустить на ВМ СУБД Postgres.
        В Postgres создать БД и пользователя с произвольным именем на ваш выбор и дать этому пользователю полные права на созданную БД.
        Создать Docker-образ:
            Содержащий Python 3, а также библиотеки для него: Flask, Psycopg2 (для работы с СУБД Postgres, хранящей данные) и ConfigParser.
            Содержащий код приложения на Python (копирующий его с локальной файловой системы). На хостовой ФС код будет лежать по пути: /srv/app/web.py.
            Содержащий конфигурационный файл приложения (копирующий его с локальной ФС). На хостовой ФС конфигурационный файл будет лежать по пути: /srv/app/conf/web.conf.
            При запуске контейнера, он должен запускать описанный выше код.
            Образ должен быть оптимизирован с учетом лучших практик.
            Пришлите ментору свой Dockerfile, скриншот с работающим приложением и размер образа.

Для проверки работоспособности образа можно использовать приложение из репозитория (не забудьте поправить конфиг-файл).

Для этого потребуется склонировать репозиторий из GitHub (заодно вспомним, как работать с Git), создать директорию /srv/app/conf и расположить файлы из склонированного репозитория так:

        web.py расположить в /srv/app/;
        web.conf расположить в /srv/app/conf/.

Затем запустить Docker-контейнер, смонтировав /srv/app с хостовой ФС в контейнерную, а также пробросив порт 80 из контейнера в хостовую сеть.
========================================================================
Для заполнения:

---
ya_terra/cloud-init.yaml:
  - name: логин
    ssh_authorized_keys:
      - подставить свой ssh ~/.ssh/id_rsa.pub
---
ya_terra/main.tf:
  backend "s3" {
    access_key = "открытый ключ для сервисного аккаунта"
    secret_key = "закрытый ключ для сервисного аккаунта"
  }

provider "yandex" {
  service_account_key_file = file("ключ сервисного аккаунта")
  cloud_id                 = "cloud_id"
  folder_id                = "folder_id"
}

resource "yandex_compute_instance" "vm_1" {
  metadata = {
    user-data = "${file("путь_до_клауд_инит/cloud-init.yaml")}"
  }
}
---
ansible/inventory:

[remote]
ip_addr_vm_1 - ip облачного ПК

[remote:vars]
vers = 12 - версия postgresql
db_user = user - пользователь бд
db_password = password - пароль пользователя
db_name = database - название бд

---
/docker/web.conf:
Поменять переменные на необходимые для подключения к базе
[database]
db_host = '172.17.0.1' - ip хоста docker
db_port = '5432' - порт подключения
db_user = 'user' - пользователь бд
db_password = 'password' - пароль от пользователя
db_name = 'database' - имя бд
---
/docker/web.py
if __name__ == "__main__":
    app.run(host='0.0.0.0', port=80) - порт по которому будет работать flask
---
!!!
В конфиге postgresql(/etc/postgresql/{{ vers }}/main/postgresql.conf) на хосте(облачной vm), необходимо слушать всех:

listen_addresses = '*'

